version: '3.8'

# ═══════════════════════════════════════════════════════════════
# inopay - Stack de Production Souveraine
# Généré par InoPay Liberation Pack v4.0
# ═══════════════════════════════════════════════════════════════

services:
  # ─────────────────────────────────────────────────────────────
  # FRONTEND - Application React avec Caddy (auto-SSL)
  # ─────────────────────────────────────────────────────────────
  frontend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: inopay-frontend
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    environment:
      - DOMAIN=${DOMAIN:-localhost}
      - VITE_API_URL=${VITE_API_URL:-http://localhost/api}
    volumes:
      - caddy_data:/data
      - caddy_config:/config
    networks:
      - app-network
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:80/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    depends_on:
      backend:
        condition: service_healthy



  # ─────────────────────────────────────────────────────────────
  # BACKEND - API Express.js (converti depuis Edge Functions)
  # ─────────────────────────────────────────────────────────────
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: inopay-backend
    restart: unless-stopped
    expose:
      - "3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
      - CORS_ORIGIN=${DOMAIN:-*}
      - PORT=${PORT}
      - NODE_ENV=${NODE_ENV}
      - JWT_SECRET=${JWT_SECRET}
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_SERVICE_ROLE_KEY=${SUPABASE_SERVICE_ROLE_KEY}
      - STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY}
      - SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
      - GITHUB_PERSONAL_ACCESS_TOKEN=${GITHUB_PERSONAL_ACCESS_TOKEN}
      - RESEND_API_KEY=${RESEND_API_KEY}
      - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY}
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - ENCRYPTION_MASTER_KEY=${ENCRYPTION_MASTER_KEY}
      - LOVABLE_API_KEY=${LOVABLE_API_KEY}
      - TWILIO_ACCOUNT_SID=${TWILIO_ACCOUNT_SID}
      - TWILIO_AUTH_TOKEN=${TWILIO_AUTH_TOKEN}
      - TWILIO_PHONE_NUMBER=${TWILIO_PHONE_NUMBER}
      - STRIPE_WEBHOOK_SECRET=${STRIPE_WEBHOOK_SECRET}
      - VITE_SUPABASE_URL=${VITE_SUPABASE_URL}
      - VITE_SUPABASE_PUBLISHABLE_KEY=${VITE_SUPABASE_PUBLISHABLE_KEY}
      - label=${label}
      - progress=${progress}
      - VITE_SUPABASE_ANON_KEY=${VITE_SUPABASE_ANON_KEY}
      - VITE_STRIPE_PUBLISHABLE_KEY=${VITE_STRIPE_PUBLISHABLE_KEY}
      - token=${token}
      - platformName=${platformName}
      - cleanedFilesCount=${cleanedFilesCount}
      - platform=${platform}
      - name=${name}
      - value=${value}
      - index=${index}
      - INOPAY_GREEN=${INOPAY_GREEN}
      - INOPAY_DARK_GREEN=${INOPAY_DARK_GREEN}
      - INOPAY_NAVY=${INOPAY_NAVY}
      - preheader=${preheader}
      - INOPAY_LOGO_URL=${INOPAY_LOGO_URL}
      - content=${content}
      - upgraded=${upgraded}
      - imported=${imported}
      - csv=${csv}
      - filename=${filename}
      - failedCount=${failedCount}
      - service=${service}
      - email=${email}
      - serverAge=${serverAge}
      - newTesterEmail=${newTesterEmail}
      - percentage=${percentage}
      - creditAmount=${creditAmount}
      - countdown=${countdown}
      - filePath=${filePath}
      - projectName=${projectName}
      - totalSavings=${totalSavings}
      - completedCount=${completedCount}
      - path=${path}
      - dep=${dep}
      - config=${config}
      - folder=${folder}
      - githubRepoUrl=${githubRepoUrl}
      - idx=${idx}
      - serverIp=${serverIp}
      - dashboardUrl=${dashboardUrl}
      - providerName=${providerName}
      - creditType=${creditType}
      - currentPath=${currentPath}
      - part=${part}
      - githubToken=${githubToken}
      - username=${username}
      - cleanedUsername=${cleanedUsername}
      - maxSelection=${maxSelection}
      - serverName=${serverName}
      - professionalPrice=${professionalPrice}
      - exports=${exports}
      - totalProcessed=${totalProcessed}
      - fileName=${fileName}
      - WEBHOOK_SECRET=${WEBHOOK_SECRET}
      - totalProjects=${totalProjects}
      - deployedCount=${deployedCount}
      - readyCount=${readyCount}
      - analyzedCount=${analyzedCount}
      - averageScore=${averageScore}
      - deploymentRate=${deploymentRate}
      - statusColor=${statusColor}
      - statusLabel=${statusLabel}
      - savings=${savings}
      - mainScope=${mainScope}
      - cleanedOwner=${cleanedOwner}
      - externalBackendUrl=${externalBackendUrl}
      - missingScopes=${missingScopes}
      - repoOwner=${repoOwner}
      - repoName=${repoName}
      - attempt=${attempt}
      - retries=${retries}
      - fetchedCount=${fetchedCount}
      - count=${count}
      - successCount=${successCount}
      - errorCount=${errorCount}
      - className=${className}
      - serverProvider=${serverProvider}
      - supabaseUrl=${supabaseUrl}
      - supabaseServiceKey=${supabaseServiceKey}
      - symbol=${symbol}
      - gridCols=${gridCols}
      - vibeScore=${vibeScore}
      - freedomScore=${freedomScore}
      - savingsScore=${savingsScore}
      - currentToken=${currentToken}
      - ext=${ext}
      - bytes=${bytes}
      - char=${char}
      - expected=${expected}
      - prefix=${prefix}
      - key=${key}
      - color=${color}
      - formDescriptionId=${formDescriptionId}
      - formMessageId=${formMessageId}
      - SIDEBAR_COOKIE_NAME=${SIDEBAR_COOKIE_NAME}
      - openState=${openState}
      - SIDEBAR_COOKIE_MAX_AGE=${SIDEBAR_COOKIE_MAX_AGE}
      - minutes=${minutes}
      - hours=${hours}
      - mins=${mins}
      - VITE_INFRA_MODE=${VITE_INFRA_MODE}
      - VITE_AI_BASE_URL=${VITE_AI_BASE_URL}
      - VITE_AI_MODEL=${VITE_AI_MODEL}
      - VITE_SELF_SUPABASE_URL=${VITE_SELF_SUPABASE_URL}
      - VITE_SELF_SUPABASE_ANON_KEY=${VITE_SELF_SUPABASE_ANON_KEY}
      - VITE_SELF_SUPABASE_SERVICE_KEY=${VITE_SELF_SUPABASE_SERVICE_KEY}
      - VITE_MINIO_URL=${VITE_MINIO_URL}
      - VITE_MINIO_ACCESS_KEY=${VITE_MINIO_ACCESS_KEY}
      - VITE_MINIO_SECRET_KEY=${VITE_MINIO_SECRET_KEY}
      - VITE_OLLAMA_BASE_URL=${VITE_OLLAMA_BASE_URL}
      - VITE_SMTP_HOST=${VITE_SMTP_HOST}
      - VITE_SMTP_PORT=${VITE_SMTP_PORT}
      - VITE_SOKETI_HOST=${VITE_SOKETI_HOST}
      - VITE_SOKETI_PORT=${VITE_SOKETI_PORT}
      - VITE_SOKETI_APP_KEY=${VITE_SOKETI_APP_KEY}
      - VITE_MEILISEARCH_URL=${VITE_MEILISEARCH_URL}
      - VITE_MEILISEARCH_API_KEY=${VITE_MEILISEARCH_API_KEY}
      - VITE_AUTHORIZED_DOMAINS=${VITE_AUTHORIZED_DOMAINS}
      - domain=${domain}
      - tokenToUse=${tokenToUse}
      - PROD=${PROD}
      - trimmed=${trimmed}
      - VITE_OLLAMA_MODEL=${VITE_OLLAMA_MODEL}
      - VITE_SMTP_FROM=${VITE_SMTP_FROM}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - PINECONE_API_KEY=${PINECONE_API_KEY}
      - passed=${passed}
      - failed=${failed}
      - DATABASE_URL=${DATABASE_URL}
      - routeName=${routeName}
      - methodLower=${methodLower}
      - businessLogic=${businessLogic}
      - method=${method}
      - functionName=${functionName}
      - VITE_AI_URL=${VITE_AI_URL}
      - pkg=${pkg}
      - imports=${imports}
      - newPkg=${newPkg}
      - varName=${varName}
      - AI_URL=${AI_URL}
      - VITE_LOVABLE_=${VITE_LOVABLE_}
      - VITE_APP_=${VITE_APP_}
      - VITE_OLLAMA_URL=${VITE_OLLAMA_URL}
      - VITE_MEILISEARCH_KEY=${VITE_MEILISEARCH_KEY}
      - VITE_POCKETBASE_URL=${VITE_POCKETBASE_URL}
      - VITE_MINIO_ENDPOINT=${VITE_MINIO_ENDPOINT}
      - VITE_PUSHER_KEY=${VITE_PUSHER_KEY}
      - SMTP_HOST=${SMTP_HOST}
      - SMTP_PORT=${SMTP_PORT}
      - SMTP_USER=${SMTP_USER}
      - SMTP_PASS=${SMTP_PASS}
      - API_URL=${API_URL}
      - FRONTEND_URL=${FRONTEND_URL}
      - escapedDomain=${escapedDomain}
      - localBase=${localBase}
      - pattern=${pattern}
      - OLLAMA_BASE_URL=${OLLAMA_BASE_URL}
      - cdn=${cdn}
      - SUPABASE_PROJECT_ID=${SUPABASE_PROJECT_ID}
      - APP_URL=${APP_URL}
      - JWT_TOKEN=${JWT_TOKEN}
      - escapedCdn=${escapedCdn}
      - keyword=${keyword}
      - route=${route}
      - VITE_GPT_=${VITE_GPT_}
      - VITE_CODEIUM_=${VITE_CODEIUM_}
      - VITE_COPILOT_=${VITE_COPILOT_}
      - VITE_TABNINE_=${VITE_TABNINE_}
      - VITE_CODY_=${VITE_CODY_}
      - BLUE=${BLUE}
      - YELLOW=${YELLOW}
      - RED=${RED}
      - GREEN=${GREEN}
      - COOLIFY_URL=${COOLIFY_URL}
      - COOLIFY_TOKEN=${COOLIFY_TOKEN}
      - APP_ID=${APP_ID}
      - SCRIPT_DIR=${SCRIPT_DIR}
      - diffMinutes=${diffMinutes}
      - diffHours=${diffHours}
      - diffDays=${diffDays}
      - trimmedUrl=${trimmedUrl}
      - url=${url}
      - volumes=${volumes}
      - NEXT_PUBLIC_CLERK=${NEXT_PUBLIC_CLERK}
      - NEXT_PUBLIC_SUPABASE_URL=${NEXT_PUBLIC_SUPABASE_URL}
      - serviceName=${serviceName}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - SENSITIVE_PREFIX=${SENSITIVE_PREFIX}
      - file=${file}
      - type=${type}
      - quote=${quote}
      - prompt=${prompt}
      - schemaName=${schemaName}
      - patternName=${patternName}
      - importPattern=${importPattern}
      - icon=${icon}
      - VITE_APP_CONFIG=${VITE_APP_CONFIG}
      - line=${line}
      - text=${text}
      - score=${score}
      - appName=${appName}
      - chartName=${chartName}
      - compName=${compName}
      - date=${date}
      - issue=${issue}
      - warning=${warning}
      - safeName=${safeName}
      - signature=${signature}
      - totalIssues=${totalIssues}
      - dir=${dir}
      - importPath=${importPath}
      - suggestion=${suggestion}
      - checksJson=${checksJson}
      - envVarsJson=${envVarsJson}
      - webhooksJson=${webhooksJson}
      - elapsed=${elapsed}
      - CORS_ORIGIN=${CORS_ORIGIN}
      - LOG_LEVEL=${LOG_LEVEL}
      - AI_BASE_URL=${AI_BASE_URL}
      - AI_MODEL=${AI_MODEL}
      - AI_API_KEY=${AI_API_KEY}
      - VITE_APP_NAME=${VITE_APP_NAME}
      - message=${message}
      - timestamp=${timestamp}
      - provider=${provider}
      - col=${col}
      - description=${description}
      - middlewareName=${middlewareName}
      - condition=${condition}
      - role=${role}
      - VITE_API_KEY=${VITE_API_KEY}
      - JWT_EXPIRY=${JWT_EXPIRY}
      - REFRESH_TOKEN_EXPIRY=${REFRESH_TOKEN_EXPIRY}
      - KEYCLOAK_ADMIN_PASSWORD=${KEYCLOAK_ADMIN_PASSWORD}
      - resetToken=${resetToken}
      - migrated=${migrated}
      - skipped=${skipped}
      - errorText=${errorText}
      - baseUrl=${baseUrl}
      - VITE_AI_PROVIDER=${VITE_AI_PROVIDER}
      - VITE_AI_API_KEY=${VITE_AI_API_KEY}
      - VITE_AI_EMBEDDING_MODEL=${VITE_AI_EMBEDDING_MODEL}
      - criticalCount=${criticalCount}
      - gradeEmoji=${gradeEmoji}
      - grade=${grade}
      - item=${item}
      - rec=${rec}
      - polyfillsGenerated=${polyfillsGenerated}
      - VITE_=${VITE_}
      - version=${version}
      - rootPrefix=${rootPrefix}
      - totalFiles=${totalFiles}
      - removed=${removed}
      - fileExt=${fileExt}
      - hookName=${hookName}
      - keyPrefix=${keyPrefix}
      - identifier=${identifier}
      - ipAddress=${ipAddress}
      - reason=${reason}
      - endpointName=${endpointName}
      - delay=${delay}
      - errorType=${errorType}
      - step=${step}
      - detailsStr=${detailsStr}
      - action=${action}
      - serviceRoleKey=${serviceRoleKey}
      - signedOutCount=${signedOutCount}
      - jobId=${jobId}
      - normalized=${normalized}
      - ghOwner=${ghOwner}
      - repoClean=${repoClean}
      - gitBranchToUse=${gitBranchToUse}
      - gitCommitShaToUse=${gitCommitShaToUse}
      - project_name=${project_name}
      - coolifyUrl=${coolifyUrl}
      - errorMessage=${errorMessage}
      - owner=${owner}
      - repo=${repo}
      - appUuid=${appUuid}
      - force_rebuild=${force_rebuild}
      - force_no_cache=${force_no_cache}
      - github_repo_url=${github_repo_url}
      - fix_type=${fix_type}
      - auto_redeploy=${auto_redeploy}
      - defaultBranch=${defaultBranch}
      - currentCommitSha=${currentCommitSha}
      - newCommitSha=${newCommitSha}
      - coolify_app_uuid=${coolify_app_uuid}
      - deployment_id=${deployment_id}
      - msg=${msg}
      - deployment_uuid=${deployment_uuid}
      - app_uuid=${app_uuid}
      - loadTime=${loadTime}
      - title=${title}
      - passedCount=${passedCount}
      - apiKey=${apiKey}
      - code=${code}
      - tokensUsed=${tokensUsed}
      - userApiProvider=${userApiProvider}
      - providerUsed=${providerUsed}
      - internalCostCents=${internalCostCents}
      - apiCostCents=${apiCostCents}
      - deletedDeploymentRecords=${deletedDeploymentRecords}
      - server_id=${server_id}
      - verify_health=${verify_health}
      - force=${force}
      - deletedCount=${deletedCount}
      - branch=${branch}
      - DB_HOST=${DB_HOST}
      - DB_PORT=${DB_PORT}
      - DB_NAME=${DB_NAME}
      - DB_USER=${DB_USER}
      - DB_PASSWORD=${DB_PASSWORD}
      - DB_SSL=${DB_SSL}
      - dbType=${dbType}
      - origin=${origin}
      - serviceType=${serviceType}
      - excessFiles=${excessFiles}
      - supplementAmount=${supplementAmount}
      - secret_type=${secret_type}
      - error=${error}
      - preferredDeploymentUuid=${preferredDeploymentUuid}
      - deploymentUuid=${deploymentUuid}
      - deploymentStatus=${deploymentStatus}
      - projectUuid=${projectUuid}
      - is_retry=${is_retry}
      - retry_count=${retry_count}
      - decryptedCoolifyToken=${decryptedCoolifyToken}
      - repoAuthMode=${repoAuthMode}
      - existingAppUuid=${existingAppUuid}
      - fallbackError=${fallbackError}
      - envError=${envError}
      - attempts=${attempts}
      - maxAttempts=${maxAttempts}
      - buildStatus=${buildStatus}
      - finalStatus=${finalStatus}
      - usedDeploymentUuid=${usedDeploymentUuid}
      - isRedeploy=${isRedeploy}
      - buildLogs=${buildLogs}
      - runtimeLogs=${runtimeLogs}
      - envLines=${envLines}
      - serverId=${serverId}
      - deploymentId=${deploymentId}
      - maxRetries=${maxRetries}
      - finalDomain=${finalDomain}
      - deployedUrl=${deployedUrl}
      - VITE_ANON_KEY=${VITE_ANON_KEY}
      - user=${user}
      - pass=${pass}
      - hostForResponse=${hostForResponse}
      - errText=${errText}
      - VITE_APP_URL=${VITE_APP_URL}
      - commit_sha=${commit_sha}
      - cleanableFiles=${cleanableFiles}
      - estimatedCostCents=${estimatedCostCents}
      - tableName=${tableName}
      - columns=${columns}
      - values=${values}
      - totalRows=${totalRows}
      - table=${table}
      - databaseFunctions=${databaseFunctions}
      - storageBucket=${storageBucket}
      - destinationUsername=${destinationUsername}
      - targetRepoName=${targetRepoName}
      - currentVersion=${currentVersion}
      - compatibleVersion=${compatibleVersion}
      - envVar=${envVar}
      - repoFullName=${repoFullName}
      - repoHtmlUrl=${repoHtmlUrl}
      - branchName=${branchName}
      - SERVICE_ROLE_SECRET=${SERVICE_ROLE_SECRET}
      - funcName=${funcName}
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - CURRENT_DATE=${CURRENT_DATE}
      - userInfo=${userInfo}
      - projectId=${projectId}
      - supabaseFileCount=${supabaseFileCount}
      - storagePath=${storagePath}
      - status=${status}
      - eventType=${eventType}
      - normalizedRepoUrl=${normalizedRepoUrl}
      - commitSha=${commitSha}
      - dry_run=${dry_run}
      - reset_coolify=${reset_coolify}
      - reset_database=${reset_database}
      - reset_github=${reset_github}
      - newConsecutiveFailures=${newConsecutiveFailures}
      - responseTimeMs=${responseTimeMs}
      - batchNumber=${batchNumber}
      - totalBatches=${totalBatches}
      - inserted=${inserted}
      - npmInstallLine=${npmInstallLine}
      - copyPackageLine=${copyPackageLine}
      - colName=${colName}
      - pgType=${pgType}
      - nullable=${nullable}
      - executed=${executed}
      - pending=${pending}
      - vpsIp=${vpsIp}
      - coolifyToken=${coolifyToken}
      - rateLimit=${rateLimit}
      - ghError=${ghError}
      - srvName=${srvName}
      - coolifyError=${coolifyError}
      - totalTime=${totalTime}
      - okCount=${okCount}
      - warningCount=${warningCount}
      - statusText=${statusText}
      - usersCount=${usersCount}
      - deploymentsCount=${deploymentsCount}
      - permissionLevel=${permissionLevel}
      - hasWritePermission=${hasWritePermission}
      - newCommit=${newCommit}
      - VITE_SUPABASE_PROJECT_ID=${VITE_SUPABASE_PROJECT_ID}
      - baseSha=${baseSha}
      - isOwnAccount=${isOwnAccount}
      - createUrl=${createUrl}
      - errorMsg=${errorMsg}
      - repoUrl=${repoUrl}
      - waitTime=${waitTime}
      - pendingPaymentId=${pendingPaymentId}
      - userEmail=${userEmail}
      - totalChanges=${totalChanges}
      - repoUrlToUse=${repoUrlToUse}
      - server_name=${server_name}
      - hetzner_api_token=${hetzner_api_token}
      - server_type=${server_type}
      - location=${location}
      - supabasePublicUrl=${supabasePublicUrl}
      - setupId=${setupId}
      - rootPassword=${rootPassword}
      - coolifyServerUuid=${coolifyServerUuid}
      - endpoint=${endpoint}
      - coolifyDeleted=${coolifyDeleted}
      - clientIP=${clientIP}
      - normalizedEmail=${normalizedEmail}
      - newSetupId=${newSetupId}
      - recoveryCommand=${recoveryCommand}
      - normalizedUrl=${normalizedUrl}
      - versionUrl=${versionUrl}
      - coolify_token=${coolify_token}
      - coolifyVersion=${coolifyVersion}
      - userName=${userName}
      - hostingProvider=${hostingProvider}
      - annualSavings=${annualSavings}
      - servicesHtml=${servicesHtml}
      - portabilityScoreAfter=${portabilityScoreAfter}
      - reportUrl=${reportUrl}
      - githubUrl=${githubUrl}
      - otpCode=${otpCode}
      - accountSid=${accountSid}
      - authToken=${authToken}
      - twilioAuth=${twilioAuth}
      - callbackUrl=${callbackUrl}
      - db_user=${db_user}
      - db_password=${db_password}
      - dbHost=${dbHost}
      - dbPort=${dbPort}
      - db_name=${db_name}
      - dbUser=${dbUser}
      - dbPassword=${dbPassword}
      - dbName=${dbName}
      - scriptUrl=${scriptUrl}
      - installCommand=${installCommand}
      - targetSupabaseUrl=${targetSupabaseUrl}
      - targetSupabaseServiceKey=${targetSupabaseServiceKey}
      - projectRef=${projectRef}
      - targetUrl=${targetUrl}
      - customerName=${customerName}
      - attemptCount=${attemptCount}
      - invoiceUrl=${invoiceUrl}
      - VERSION=${VERSION}
      - coolifyStatus=${coolifyStatus}
      - fqdn=${fqdn}
      - testUrl=${testUrl}
      - urlHealthy=${urlHealthy}
      - urlError=${urlError}
      - newStatus=${newStatus}
      - newHealthStatus=${newHealthStatus}
      - appsUrl=${appsUrl}
      - appsCount=${appsCount}
      - searchType=${searchType}
      - credit_type=${credit_type}
      - coolify_url=${coolify_url}
      - healthUrl=${healthUrl}
      - responseText=${responseText}
      - useBranch=${useBranch}
      - destServiceKey=${destServiceKey}
      - remainingAttempts=${remainingAttempts}
      - depName=${depName}
      - scriptName=${scriptName}
      - scriptCmd=${scriptCmd}
      - certificationStatus=${certificationStatus}
      - userAgent=${userAgent}
      - remotePath=${remotePath}
      - customerId=${customerId}
      - number=${number}
      - total=${total}
      - horizontal=${horizontal}
      - bar=${bar}
      - outputPath=${outputPath}
      - absolutePath=${absolutePath}
      - projectPath=${projectPath}
      - duration=${duration}
      - CYAN=${CYAN}
      - PROJECT_REF=${PROJECT_REF}
      - TOTAL=${TOTAL}
      - FUNC=${FUNC}
      - SUCCESS=${SUCCESS}
      - FAILED=${FAILED}
      - PURPLE=${PURPLE}
      - MINIO_PASSWORD=${MINIO_PASSWORD}
      - INSTALL_DIR=${INSTALL_DIR}
      - SERVER_IP=${SERVER_IP}
      - TOTAL_RAM=${TOTAL_RAM}
      - DISK_SPACE=${DISK_SPACE}
      - SUPABASE_SERVICE_KEY=${SUPABASE_SERVICE_KEY}
      - MINIO_ACCESS_KEY=${MINIO_ACCESS_KEY}
      - MINIO_SECRET_KEY=${MINIO_SECRET_KEY}
      - MEILISEARCH_API_KEY=${MEILISEARCH_API_KEY}
      - SCORE=${SCORE}
      - BOUNCER_KEY=${BOUNCER_KEY}
      - filesScanned=${filesScanned}
      - scoreColor=${scoreColor}
      - MIN_SCORE=${MIN_SCORE}
      - fileCount=${fileCount}
      - relativePath=${relativePath}
      - errors=${errors}
      - warnings=${warnings}

    networks:
      - app-network
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s





  # ─────────────────────────────────────────────────────────────
  # WATCHTOWER - Mise à jour automatique des containers
  # ─────────────────────────────────────────────────────────────
  watchtower:
    image: containrrr/watchtower
    container_name: inopay-watchtower
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - WATCHTOWER_CLEANUP=true
      - WATCHTOWER_POLL_INTERVAL=86400  # Vérifie toutes les 24h
      - WATCHTOWER_INCLUDE_STOPPED=false
    networks:
      - app-network

# ═══════════════════════════════════════════════════════════════
# VOLUMES PERSISTANTS
# ═══════════════════════════════════════════════════════════════
volumes:
  caddy_data:
  caddy_config:


# ═══════════════════════════════════════════════════════════════
# RÉSEAU
# ═══════════════════════════════════════════════════════════════
networks:
  app-network:
    driver: bridge
